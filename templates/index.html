<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17802839805"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'AW-17802839805');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track Old School RuneScape (OSRS) player counts in real-time. View historical data, world populations, and activity trends.">
    <meta name="keywords" content="OSRS, Old School RuneScape, player count, population tracker, runescape, mmo, rpg, statistics, world tracker">
    <meta name="author" content="UsefulEndymion">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="OSRS Population Tracker - Real-time Stats">
    <meta property="og:description" content="Real-time player count tracking and historical statistics for Old School RuneScape.">
    <meta property="og:image" content="https://i.imgur.com/hRPMzoJ.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="OSRS Population Tracker - Real-time Stats">
    <meta property="twitter:description" content="Real-time player count tracking and historical statistics for Old School RuneScape.">
    <meta property="twitter:image" content="https://i.imgur.com/hRPMzoJ.png">

    <title>OSRS Population Tracker - Real-time Player Count & Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <div id="connection-lost">
        <div class="title">Connection lost</div>
        <div class="message">Please wait - attempting to reestablish</div>
    </div>

    <!-- Easter Egg: Gnome Child -->
    <img id="gnome-child" src="https://oldschool.runescape.wiki/images/Gnome_child_chathead.png?c099b" alt="Gnome Child">

    <div class="container">
        <div class="card">
            <h1>OSRS Players Online</h1>
            <div id="player-count" class="big-number">Loading...</div>
            <div id="last-updated" class="timestamp" style="margin-bottom: 5px;">Wait a moment...</div>
            <div id="player-breakdown" style="font-size: 1em; color: #d4d4d4; margin-bottom: 5px; display: none;">
                <span style="color: #ffff00;">Members: <span id="members-count">...</span></span>
                <span style="margin: 0 10px;">|</span>
                <span style="color: #aaaaaa;">F2P: <span id="f2p-count">...</span></span>
                <div id="breakdown-updated" class="timestamp" style="font-size: 0.8em; margin-top: 4px; color: #888;"></div>
            </div>
        </div>

        <div class="card">
            <!-- New Filters Row -->
            <div style="display:flex; flex-wrap:wrap; gap:12px; justify-content:center; align-items:center; margin-bottom:12px; padding-bottom:12px; border-bottom: 1px solid #383023;">
                <label style="font-size:0.9em; color:#bdbdbd;">World:
                    <select id="worldSelect">
                        <option value="">All Worlds</option>
                    </select>
                </label>
                <label style="font-size:0.9em; color:#bdbdbd;">Location:
                    <select id="locationSelect">
                        <option value="">All Locations</option>
                    </select>
                </label>
                <label style="font-size:0.9em; color:#bdbdbd;">Type:
                    <select id="f2pSelect">
                        <option value="">All Types</option>
                        <option value="1">Free-to-Play</option>
                        <option value="0">Members</option>
                    </select>
                </label>
                <label style="font-size:0.9em; color:#bdbdbd; border-left: 1px solid #5b4a3c; padding-left: 12px; margin-left: 4px;">Compare:
                    <select id="compareSelect" style="background:#383023; border-color:#ff981f;">
                        <option value="none">None</option>
                        <option value="type">F2P vs Members</option>
                        <option value="location">Regions</option>
                        <option value="worlds">All Worlds</option>
                    </select>
                </label>
            </div>

            <div style="display:flex; flex-wrap:wrap; gap:8px; justify-content:center; align-items:center; margin-bottom:12px;">
                <label style="font-size:0.9em; color:#bdbdbd;">Granularity:
                    <select id="granularitySelect">
                        <option value="5m">5 min</option>
                        <option value="15m">15 min</option>
                        <option value="30m">30 min</option>
                        <option value="hour" selected>Hour</option>
                        <option value="day">Day</option>
                        <option value="week">Week</option>
                        <option value="month">Month</option>
                    </select>
                </label>
                <span id="granularityInfo" class="info" style="display:inline-block;" role="note">
                    <span class="info-icon" aria-hidden="true">ℹ</span>
                    <span class="tooltip" role="tooltip">Minute options disabled for ranges > 30 days</span>
                </span>
                <label style="font-size:0.9em; color:#bdbdbd;">Aggregation:
                    <select id="aggregationSelect">
                        <option value="max" selected>Peak</option>
                        <option value="avg">Average</option>
                    </select>
                </label>


                <label style="font-size:0.9em; color:#bdbdbd;">Start:
                    <input id="startInput" type="datetime-local">
                </label>
                <label style="font-size:0.9em; color:#bdbdbd;">End:
                    <input id="endInput" type="datetime-local">
                </label>

                <div class="mobile-break"></div>

                <button id="applyRangeBtn">Update</button>
                <button id="resetZoomBtn">Reset Zoom</button>

                <div style="display:flex; gap:6px; margin-left:8px; align-items:center;">
                    <label style="font-size:0.9em; color:#bdbdbd;">Range:
                        <select id="presetSelect">
                            <option value="custom" disabled hidden>Custom</option>
                            <option value="3h">Last 3h</option>
                            <option value="6h">Last 6h</option>
                            <option value="12h">Last 12h</option>
                            <option value="24h">Last 24h</option>
                            <option value="7d" selected>Last 7d</option>
                            <option value="30d">Last 30d</option>
                            <option value="6m">Last 6m</option>
                            <option value="1y">Last 1y</option>
                            <option value="5y">Last 5y</option>
                            <option value="10y">Last 10y</option>
                        </select>
                    </label>
                </div>
                <div id="loadingSpinner" style="display:none; margin-left:8px; color:#bdbdbd; font-size:0.9em;">Loading…</div>
            </div>

            <canvas id="populationChart"></canvas>
            <div id="chartError" class="timestamp" style="margin-top:8px; color:#ff6b6b; display:none;"></div>
            <div id="chart-timezone" class="timestamp" style="margin-top:8px;"></div>
            <div id="about-app" style="margin-top:12px; text-align:left; color:#bdbdbd; font-size:0.95em;">
                <button id="about-toggle" style="background:#232323; color:#ff9800; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; font-size:1em;">More about this site</button>
                <div id="about-content" style="display:none; margin-top:10px;">
                    <strong>About this chart:</strong>
                    <div style="margin-top:6px;">This chart shows the number of players online. Use the controls above to change the date range and granularity. For large ranges the backend should return aggregated data for best performance.</div>
                    <div style="margin-top:8px;">How the bot works: a small python script periodically checks the Old School RuneScape homepage, extracts the reported online player count, and stores timestamped samples in the database. It runs at regular intervals (every 5 minutes by default).</div>
                    <div style="margin-top:8px;">Historical data (older than Dec 2, 2025) was sourced from <a href="https://www.misplaceditems.com/rs_tools/graph" target="_blank" rel="noopener noreferrer">misplaceditems.com — RS Tools (graph)</a> as well as <a href="https://playercount.dev/" target="_blank" rel="noopener noreferrer">playercount.dev</a>. That historical dataset is coarser: its timestamps and sample intervals are not as fine-grained as the samples collected by this bot, so recent data (collected by the bot) will appear with higher resolution than the imported history.</div>
                    <div style="margin-top:8px; color: #ff981f;"><strong>Note:</strong> Detailed world data (including specific world counts, F2P vs Members splits, and regional data) only started being collected on Dec 4, 2025. Any data prior to this date only contains the global player count.</div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>

    <footer class="site-footer">
        <div class="container">
            <a href="https://github.com/UsefulEndymion/osrsplayercount" target="_blank" rel="noopener noreferrer" class="github-link">
                View/Contribute on GitHub
                <span class="tooltip">beware the code is very <b>slop</b>-y</span>
            </a>
            <img id="scimitar-toggle" src="https://oldschool.runescape.wiki/images/Dragon_scimitar.png?36084" alt="Toggle Dragon Scimitar Cursor" title="Toggle Dragon Scimitar Cursor">
        </div>
    </footer>

    <script>
        // Easter Egg: Play sound after 20 minutes
        setTimeout(() => {
            const audio = new Audio('https://oldschool.runescape.wiki/images/Armadyl_Eye_sound.ogg?37997');
            audio.volume = 0.5;
            audio.play().catch(e => console.error("Audio play failed (autoplay policy?):", e));
        }, 60 * 60 * 1000);
    </script>

</body>
</html>